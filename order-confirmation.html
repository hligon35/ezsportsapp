<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Thank you for your order | EZ Sports Netting</title>
  <link rel="stylesheet" href="assets/css/styles.css" />
  <!-- Point API calls to the Render backend when this page is served from a static host -->
  <meta name="api-base" content="https://ezsportsapp.onrender.com" />
  <style>
    .confirm-card{max-width:760px;margin:2rem auto;background:#fff;border:1px solid #e6edf6;border-radius:1rem;padding:2rem;box-shadow:0 4px 24px rgba(12,32,64,.08)}
    .muted{color:#516173}
    .order-extras{margin:.5rem 0 1rem;}
  </style>
  <script>
    function currency(n){return n.toLocaleString(undefined,{style:'currency',currency:'USD'})}
    function getApiBase(){
      try {
        if (window.__API_BASE) return String(window.__API_BASE).replace(/\/$/, '');
        const meta = document.querySelector('meta[name="api-base"]');
        if (meta && meta.content) return String(meta.content).replace(/\/$/, '');
      } catch {}
      return '';
    }
    async function fetchJsonWithBase(path, opts){
      const guessed = 'https://ezsportsapp.onrender.com';
      const bases = [ getApiBase(), guessed ].filter(Boolean);
      for (const base of bases){
        const url = base ? (base + path) : path;
        try {
          const res = await fetch(url, opts);
          if (res.ok) return await res.json();
          // try next base on 404
          if (res.status === 404) continue;
        } catch {}
      }
      return null;
    }
    async function load(){
      try{
        const params=new URLSearchParams(location.search);
        const id=params.get('id');
        // Prefer fetching a live order summary when id present
        let order=null;
        if (id) {
          try {
            order = await fetchJsonWithBase('/api/orders/summary/'+encodeURIComponent(id), { cache:'no-store' });
          } catch {}
        }
        if(!order){
          order=JSON.parse(sessionStorage.getItem('lastOrder')||'null');
        }
        if(order){
          document.getElementById('order-id').textContent = order.id || id || '—';
          document.getElementById('total').textContent = currency(Number(order.total||0));
          const lines=(order.items||[]).map(i=>{
            const name = i.productName || i.id || 'Item';
            const isNet = String(i.category||'').toLowerCase()==='netting' || String(i.id||'').toLowerCase().startsWith('custom-net-');
            const parts = [];
            if ((i.size||'').trim()) parts.push(`Size ${i.size}`);
            if ((i.color||'').trim()) parts.push(`${isNet ? 'Spec' : 'Color'} ${i.color}`);
            const variant = parts.length ? ` <div class=\"muted text-xs\">${parts.join(', ')}</div>` : '';
            const sku = i.id ? ` <div class=\"muted text-xs\">SKU: ${i.id}</div>` : '';
            const qty = i.quantity || i.qty || 0;
            return `<li><div><strong>${name}</strong>${variant}${sku}</div><div class=\"muted\">× ${qty}</div></li>`;
          }).join('');
          document.getElementById('lines').innerHTML = lines || '<li>No items</li>';
          const extras = document.getElementById('order-extras');
          if (extras) {
            const bits = [];
            if (typeof order.subtotal === 'number') bits.push(`<div>Subtotal: <strong>${currency(Number(order.subtotal))}</strong></div>`);
            if (typeof order.shipping === 'number') {
              const s = Number(order.shipping);
              const shipStr = s === 0 ? 'Free' : currency(s);
              bits.push(`<div>Shipping: <strong>${shipStr}</strong></div>`);
            }
            if (typeof order.tax === 'number' && Number(order.tax) > 0) {
              bits.push(`<div>Tax: <strong>${currency(Number(order.tax))}</strong></div>`);
            }
            if (typeof order.discount === 'number' && order.discount>0) bits.push(`<div>Discount${order.couponCode?` (${order.couponCode})`:''}: <strong>-${currency(Number(order.discount))}</strong></div>`);
            extras.innerHTML = bits.join('');
          }
        } else {
          document.getElementById('order-id').textContent = id || '—';
        }
      }catch{}
    }
  </script>
  </head>
  <body onload="load()">
    <main class="container">
      <div class="confirm-card">
        <h2>Thank you for your order!</h2>
        <p class="muted">Your order <strong>#<span id="order-id">—</span></strong> has been received. A confirmation email will be sent shortly.</p>
        <h3>Order details</h3>
        <ul id="lines"></ul>
  <div id="order-extras" class="muted order-extras"></div>
  <p><strong>Total:</strong> <span id="total">$0.00</span></p>
        <div class="row gap-04">
          <a class="btn btn-primary" href="order-history.html">View your orders</a>
          <a class="btn btn-ghost" href="index.html">Continue shopping</a>
        </div>
      </div>
    </main>

    <footer class="site-footer">
      <div class="subfooter container">
        <p>© <span id="year"></span> EZ Sports Netting. <a href="privacy-policy.html">Privacy Policy</a></p>
      </div>
    </footer>

    <script>
      try { document.getElementById('year').textContent = String(new Date().getFullYear()); } catch {}
    </script>
  </body>
  </html>
